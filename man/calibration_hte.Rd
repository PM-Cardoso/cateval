% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/calibration_hte.R
\name{calibration_hte}
\alias{calibration_hte}
\title{Estimate Heterogeneous Treatment Effects Across Calibration Groups}
\usage{
calibration_hte(
  data,
  drug_var,
  drugs,
  benefit_var,
  outcome_var,
  cal_groups,
  matching = FALSE,
  adjustment_var = NULL,
  matching_var = adjustment_var,
  match.exact = NULL,
  match.antiexact = NULL
)
}
\arguments{
\item{data}{A data frame containing observed outcomes, treatment assignments, and predicted benefits.}

\item{drug_var}{Character string. Column name for the treatment assignment variable (e.g., drug).}

\item{drugs}{Character vector of length 2. Names of the two drugs to compare.}

\item{benefit_var}{Character string. Column name containing predicted benefit scores.}

\item{outcome_var}{Character string. Column name for the outcome variable (e.g., clinical measurement).}

\item{cal_groups}{Numeric or numeric vector. Number(s) of calibration groups (e.g., quantiles) to divide the data into based on predicted benefit.}

\item{matching}{Logical. Whether to perform covariate matching using the \code{MatchIt} package before estimating treatment effects.}

\item{adjustment_var}{Optional character vector. Names of covariates to include as adjustment variables in the regression model.}

\item{matching_var}{Optional character vector. Covariates to use for matching. Defaults to \code{adjustment_var} if not specified.}

\item{match.exact}{Optional character vector. Variables for exact matching. Matching on best predicted drug automatically added.}

\item{match.antiexact}{Optional character vector. Variables for anti-exact matching. \code{drug_var} automatically added.}
}
\value{
A data frame where each row corresponds to a calibration group within each \code{cal_groups} setting. Columns include:

\describe{
\item{mean}{The mean predicted benefit score for patients in the calibration group.}
\item{coef}{Estimated average treatment effect (regression coefficient) comparing the two drugs, adjusted if covariates are specified.}
\item{coef_low}{Lower bound of the 95\% confidence interval for the treatment effect.}
\item{coef_high}{Upper bound of the 95\% confidence interval for the treatment effect.}
\item{n_groups}{Number of calibration groups (i.e., the value of cal_groups) used to create this stratification.}
\item{drug1}{Name of the first drug in the comparison (from \code{drugs[1]}).}
\item{n_drug1}{Number of patients receiving drug1 within the calibration group.}
\item{drug2}{Name of the second drug in the comparison (from \code{drugs[2]}).}
\item{n_drug2}{Number of patients receiving drug2 within the calibration group.}
}
}
\description{
Estimates heterogeneous treatment effects between two drugs by stratifying patients into calibration groups based on predicted benefit scores. Optionally performs covariate matching before estimating treatment effects.
}
\details{
If multiple values are provided to \code{cal_groups}, the function will repeat the process for each value and return a combined result.
}
\examples{
# Basic usage without matching or adjustment
result <- calibration_hte(
  data = test_data,
  drug_var = "drugclass",
  drugs = c("SGLT2", "DPP4"),
  benefit_var = "benefit_score",
  outcome_var = "posthba1cfinal",
  cal_groups = 5
)

# With adjustment
result_adj <- calibration_hte(
  data = test_data,
  drug_var = "drugclass",
  drugs = c("SGLT2", "DPP4"),
  benefit_var = "benefit_score",
  outcome_var = "posthba1cfinal",
  cal_groups = 3,
  adjustment_var = c("age", "bmi", "sex")
)

# With matching and exact matching
result_match <- calibration_hte(
  data = test_data,
  drug_var = "drugclass",
  drugs = c("SGLT2", "DPP4"),
  benefit_var = "benefit_score",
  outcome_var = "posthba1cfinal",
  cal_groups = 4,
  matching = TRUE,
  adjustment_var = c("age", "bmi", "sex"),
  match.exact = "sex"
)

}
