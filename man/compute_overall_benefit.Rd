% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/compute_overall_benefit.R
\name{compute_overall_benefit}
\alias{compute_overall_benefit}
\title{Estimate Observed vs. Predicted Treatment Benefit by Calibration Group}
\usage{
compute_overall_benefit(
  data,
  drug_var,
  outcome_var,
  cal_groups,
  pred_cols = NULL,
  conc_tolerance = NULL,
  matching_var = NULL,
  match.exact = NULL,
  match.antiexact = NULL
)
}
\arguments{
\item{data}{A data frame containing treatment assignments, outcomes, covariates, and predicted benefits.}

\item{drug_var}{Character. Name of the column indicating the actual treatment received.}

\item{outcome_var}{Character. Name of the outcome variable.}

\item{cal_groups}{Integer. Number of calibration groups to divide the population into (e.g., 5 for quintiles).}

\item{pred_cols}{Character vector. Column names of predicted outcomes (or risks) for each treatment. Should share a common prefix (e.g., "pred_GLP1", "pred_SGLT2").}

\item{conc_tolerance}{Optional numeric. If supplied, defines the absolute tolerance for determining concordance with the best predicted treatment. If NULL, concordance is based on the top predicted treatment only.}

\item{matching_var}{Character vector. Covariate names used for Mahalanobis distance matching.}

\item{match.exact}{Optional character vector. Variables required to match exactly across groups. The best predicted treatment is always included.}

\item{match.antiexact}{Optional character vector. Variables for anti-exact matching. The actual treatment variable is always included.}
}
\value{
A data frame with one row per calibration group, containing:
\describe{
\item{mean}{Average predicted benefit in the group (discordant minus concordant).}
\item{coef}{Estimated observed difference in outcome (regression coefficient).}
\item{coef_low}{Lower bound of the 95\% confidence interval.}
\item{coef_high}{Upper bound of the 95\% confidence interval.}
\item{n_groups}{Total number of calibration groups.}
\item{n}{Number of matched pairs in each group.}
}
}
\description{
This function evaluates how well predicted treatment benefits correspond to observed differences in outcomes.
Patients are divided into calibration groups based on predicted benefit, and observed outcome differences
between concordant and discordant treatments are regressed on the predicted benefit difference.
Concordance is defined either by receiving the top predicted treatment or any within a specified tolerance of the best.
Matching is used to adjust for confounding.
}
\details{
The function uses MatchIt for nearest-neighbor matching to control confounding. Concordant patients are those who received their predicted-optimal treatment, while discordant patients received a suboptimal one. Within each calibration group, observed outcomes are compared using regression.
}
